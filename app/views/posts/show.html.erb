<div class="row justify-content-center">
  <% if @post.image.attached? %>
    <div class="col-lg-8 mb-3">
      <%= image_tag @post.image.variant(resize_to_limit: [1000, 1000], quality: 100), class: 'rounded img-fluid' if @post.image.attached? %>
    </div>
  <% end %>

  <%= content_tag(:div, class: @post.image.attached? ? 'col-lg-4' : 'col-8') do %>
    <div class="card bg-dark">
      <div class="card-header position-relative">
        <div class="d-flex align-items-center">
          <%= link_to @post.user, class: 'stretched-link' do %>
            <%= image_tag @post.user.avatar.variant(resize_to_limit: [48, 48]), class: 'rounded-circle me-3' %>
          <% end %>

          <div>
            <h6 class="card-title"><%= @post.user.username %></h6>

            <h6 class="card-subtitle text-muted">
              <%# If post was created less than 7 days ago, then display relative time; otherwise, timestamp %>
              <% if @post.created_at < 7.days.ago %>
                <%= @post.created_at.strftime("#{@post.created_at.day.ordinalize} of %B, %Y") %>
              <% else %>
                <%= time_ago_in_words(@post.created_at) + ' ago' %>
              <% end %>
            </h6>
          </div>
        </div>
      </div>

      <% unless @post.body.empty? %>
        <div class="card-body">
          <div class="row align-items-center">
            <% if @post.image.attached? %>
              <div class="col-sm-2"><h2><i class="bi-blockquote-left text-muted"></i></h2></div>
            <% end %>

            <div class="<%= @post.image.attached? ? 'col-sm-10' : 'card-text' %>"><%= @post.body %></div>
          </div>
        </div>
      <% end %>
    </div>

    <h2 class="mt-3">Comments</h2>

    <%= render partial: 'comments/form', locals: { comment: Comment.new, commentable: @post } %>

    <%= turbo_stream_from @post, :comments %>
    <%= tag.div id: "#{dom_id(@post)}_comments" do %>
      <%= render @post.comments %>
    <% end %>
  <% end %>
</div>